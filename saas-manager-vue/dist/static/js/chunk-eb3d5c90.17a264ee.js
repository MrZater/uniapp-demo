(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-eb3d5c90"],{"2ae3":function(e,t,a){},3868:function(e,t,a){"use strict";a("2ae3")},"5c25":function(e,t,a){e.exports=a.p+"static/img/no-data.5dbb23e5.png"},"8fe2":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"audit-message-container"},[e.isAudit?a("div",{staticClass:"audit"},[a("div",{staticClass:"search"},[a("el-row",{attrs:{gutter:0}},[a("el-col",{attrs:{span:6}},[a("el-select",{attrs:{placeholder:"请选择发布状态"},on:{change:e.handleChangepublishSts},model:{value:e.query.publishSts,callback:function(t){e.$set(e.query,"publishSts",t)},expression:"query.publishSts"}},[a("el-option",{attrs:{label:"已发布",value:1}}),a("el-option",{attrs:{label:"未发布",value:0}})],1)],1),a("el-col",{attrs:{span:2,offset:16}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addMessage}},[e._v(" 新增信息 ")])],1)],1)],1),e.tableList.length>0?a("div",{staticClass:"table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],ref:"table",staticStyle:{width:"100%"},attrs:{"header-cell-style":{background:"#f7f8fa",color:"#000"},data:e.tableList}},[a("el-table-column",{attrs:{align:"center",prop:"type",label:"消息类型"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(1==a.type?"平台通知":2==a.type?"功能更新":3==a.type?"运营活动":"")+" ")]}}],null,!1,2085613550)}),a("el-table-column",{attrs:{align:"center",prop:"title",label:"消息标题",width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("span",{staticClass:"table_title"},[e._v(e._s(s.title))])]}}],null,!1,1810605667)}),a("el-table-column",{attrs:{align:"center",prop:"publishTime",label:"发布时间"}}),a("el-table-column",{attrs:{align:"center",label:"发布状态"}},[e._v(" "+e._s(1==e.query.publishSts?"已发布":0==e.query.publishSts?"未发布":"-")+" ")]),a("el-table-column",{attrs:{align:"center",prop:"createUser",label:"发布人"}}),a("el-table-column",{attrs:{align:"center",prop:"",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("div",{staticClass:"todo"},[a("el-tooltip",{attrs:{content:"编辑",placement:"top",effect:"light"}},[a("div",{staticClass:"doicon",on:{click:function(t){return e.toEdit(s)}}},[a("svg-icon",{staticClass:"svgicon",staticStyle:{color:"#3685df"},attrs:{"icon-class":"edit"}})],1)]),a("el-tooltip",{attrs:{content:"删除",placement:"top",effect:"light"}},["SUPER_ADMIN"==e.$store.state.user.roles[0]||"ADMIN"==e.$store.state.user.roles[0]?a("div",{staticClass:"doicon",on:{click:function(t){return e.handleDelete(s)}}},[a("svg-icon",{staticClass:"svgicon",staticStyle:{color:"red"},attrs:{"icon-class":"delete"}})],1):e._e()])],1)]}}],null,!1,3265490294)})],1),a("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.query.page,"page-sizes":[5,10,15],"page-size":e.query.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):a("Empty",{staticClass:"empty"})],1):a("div",{staticClass:"edit_add"},[a("EditMessage",{attrs:{rowinfo:e.row,model:e.model},on:{goback:function(t){e.isAudit=!0},handleEdit:e.handleEdit}})],1)])},n=[],r=a("1da1"),i=(a("96cf"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-message-container"},[a("div",{staticClass:"goback",on:{click:e.goback}},[e._m(0)]),a("div",{staticClass:"messagetype"},[a("p",[e._v("消息类型")]),e._v(" ： "),a("el-select",{attrs:{placeholder:"请选择消息类型"},model:{value:e.query.type,callback:function(t){e.$set(e.query,"type",t)},expression:"query.type"}},[a("el-option",{attrs:{label:"平台通知",value:1}}),a("el-option",{attrs:{label:"功能更新",value:2}}),a("el-option",{attrs:{label:"运营活动",value:3}})],1)],1),a("div",{staticClass:"title"},[a("p",[e._v("标题")]),e._v(" ： "),a("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"请输入标题"},model:{value:e.query.title,callback:function(t){e.$set(e.query,"title",t)},expression:"query.title"}})],1),a("div",{staticClass:"editor"},[a("p",[e._v("内容")]),e._v(" ： "),a("div",{staticClass:"wrapper"},[a("div",{staticClass:"editor-box"},[a("Toolbar",{ref:"editor",staticStyle:{"border-bottom":"1px solid #ccc"},attrs:{"editor-id":e.editorId,"default-config":e.toolbarConfig,mode:e.mode}}),a("Editor",{staticStyle:{height:"500px","overflow-y":"hidden"},attrs:{"editor-id":e.editorId,"default-config":e.editorConfig,"default-html":e.defaultHtml,mode:e.mode},on:{onChange:e.onChange}})],1)])]),a("div",{staticClass:"publish"},[a("p",[e._v("发布类型")]),e._v(" ： "),a("el-radio-group",{attrs:{size:"small"},model:{value:e.query.publishType,callback:function(t){e.$set(e.query,"publishType",t)},expression:"query.publishType"}},[a("el-radio-button",{attrs:{label:0}},[e._v(" 立即发布 ")]),a("el-radio-button",{attrs:{label:1}},[e._v(" 定时发布 ")])],1)],1),1==e.query.publishType?a("div",{staticClass:"time"},[a("p",[e._v("发布时间")]),e._v(" ： "),a("el-date-picker",{attrs:{"picker-options":e.pickerOptions,clearable:!1,type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择发布时间"},model:{value:e.query.publishTime,callback:function(t){e.$set(e.query,"publishTime",t)},expression:"query.publishTime"}})],1):e._e(),a("div",{staticClass:"sumbit"},[a("div",{staticClass:"btn"},[a("el-button",{attrs:{type:""},on:{click:e.handleClear}},[e._v(" 重置 ")]),e.allowOperate?a("el-button",{attrs:{type:"primary"},on:{click:e.handleEditMessage}},[e._v(" "+e._s("add"==e.model?"确定":"edit"==e.model?"修改":"")+" ")]):e._e()],1)])])}),o=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[a("i",{staticClass:"el-icon-back"}),e._v("返回")])}],l=(a("fb6a"),a("d3b7"),a("25f0"),a("e9c4"),a("99af"),a("cb23")),c=(a("560e"),a("4e15")),u=a("c443"),d={name:"AddMessage",components:{Editor:c["a"],Toolbar:c["b"]},props:{rowinfo:Object,model:String},data:function(){return{editor:null,query:{type:"",content:"",title:"",publishType:0,publishTime:""},pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},editorId:"w-e-".concat(Math.random().toString().slice(-5)),toolbarConfig:{excludeKeys:["insertVideo","uploadVideo"]},editorConfig:{placeholder:"请输入内容...",MENU_CONF:{uploadImage:{fieldName:"file",server:"https://app.medproad.com:8008//common/upload",base64LimitSize:1024,headers:{Authorization:this.$store.getters.token},maxFileSize:1048576,maxNumberOfFiles:10,allowedFileTypes:["image/*"],customInsert:function(e,t){var a=this.$store.getters.resourceUrl+e.data;t(a,"","")}}}},mode:"default",defaultHtml:""}},computed:{allowOperate:function(){return this.$store.getters.allowOperate}},mounted:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["a"])({customConfig:{menus:["head"]}});case 2:e.editor=t.sent,e.query=JSON.parse(JSON.stringify(e.rowinfo)),e.randerContent();case 5:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){var e=Object(c["c"])(this.editorId);null!=e&&(e.destroy(),Object(c["d"])(this.editorId))},methods:{onChange:function(e){var t=Object(l["a"])({content:e.children});this.query.content=t.getHtml()},handleEditMessage:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0==e.query.publishType&&(e.query.publishTime=e.getNowDate()),e.query.type){t.next=4;break}return e.$message.error("请选择消息类型！"),t.abrupt("return");case 4:if(e.query.title){t.next=7;break}return e.$message.error("请输入标题！"),t.abrupt("return");case 7:if(1!=e.query.publishType||e.query.publishTime){t.next=10;break}return e.$message.error("请选择发布时间！"),t.abrupt("return");case 10:if("add"!=e.model){t.next=19;break}return t.next=13,Object(u["a"])(e.query);case 13:if(a=t.sent,200===a.code){t.next=16;break}return t.abrupt("return");case 16:e.$message.success("新增成功！"),t.next=26;break;case 19:if("edit"!=e.model){t.next=26;break}return t.next=22,Object(u["b"])(e.query);case 22:if(s=t.sent,200===s.code){t.next=25;break}return t.abrupt("return");case 25:e.$message.success("修改成功！");case 26:e.$store.dispatch("user/getInfo"),e.$emit("handleEdit");case 28:case"end":return t.stop()}}),t)})))()},getNowDate:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1),s=e.getDate()>=10?e.getDate():"0"+e.getDate(),n=e.getHours()>=10?e.getHours():"0"+e.getHours(),r=e.getMinutes()>=10?e.getMinutes():"0"+e.getMinutes(),i=e.getSeconds()>=10?e.getSeconds():"0"+e.getSeconds();return"".concat(t,"-").concat(a,"-").concat(s," ").concat(n,":").concat(r,":").concat(i)},randerContent:function(){Object(c["c"])(this.editorId).clear(),Object(c["c"])(this.editorId).dangerouslyInsertHtml(this.query.content)},handleClear:function(){this.query={type:"",content:"",title:"",publishType:0,publishTime:""},Object(c["c"])(this.editorId).clear()},goback:function(){this.$emit("goback")}}},p=d,g=(a("ba3c"),a("2877")),b=Object(g["a"])(p,i,o,!1,null,"5b0bcc30",null),h=b.exports,m=a("fa47"),f={components:{EditMessage:h,Empty:m["a"]},data:function(){return{model:"",isAudit:!0,query:{publishSts:1,page:1,limit:10},total:0,isLoading:!1,tableList:[],row:{}}},mounted:function(){this.getMessagePage()},methods:{isPub:function(e){var t=new Date(e).getTime(),a=(new Date).getTime();return t<a},handleChangepublishSts:function(){this.query.page=1,this.getMessagePage()},getMessagePage:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.next=3,Object(u["d"])(e.query);case 3:if(a=t.sent,200==a.code){t.next=6;break}return t.abrupt("return");case 6:e.tableList=a.data.items,e.total=a.data.total,e.isLoading=!1,e.$bus.$emit("totop");case 10:case"end":return t.stop()}}),t)})))()},handleSizeChange:function(e){this.query.limit=e,this.getMessagePage()},handleCurrentChange:function(e){this.query.page=e,this.getMessagePage()},addMessage:function(){this.row={publishType:0},this.isAudit=!1,this.model="add"},handleEdit:function(){this.isAudit=!0,this.query.page=1,this.getMessagePage()},toEdit:function(e){this.row=e,this.model="edit",this.isAudit=!1},handleDelete:function(e){var t=this;this.$confirm("此操作将永久删除该条信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function a(){var s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(u["b"])({id:e.id,sts:"D"});case 2:if(s=a.sent,200===s.code){a.next=5;break}return a.abrupt("return");case 5:t.query.page=1,t.getMessagePage(),t.$message.success("删除成功！"),1==s.data.unReadMessage?t.$store.commit("user/SET_UNREADMESSAGE","1"):t.$store.commit("user/SET_UNREADMESSAGE","0");case 9:case"end":return a.stop()}}),a)})))).catch((function(){}))}}},y=f,v=(a("3868"),Object(g["a"])(y,s,n,!1,null,"89250694",null));t["default"]=v.exports},"96ac":function(e,t,a){},ba3c:function(e,t,a){"use strict";a("96ac")},c443:function(e,t,a){"use strict";a.d(t,"d",(function(){return n})),a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return o})),a.d(t,"e",(function(){return l}));var s=a("b775");function n(e){return Object(s["a"])({url:"/message/page",method:"post",data:e})}function r(e){return Object(s["a"])({url:"/message/add",method:"post",data:e})}function i(e){return Object(s["a"])({url:"/message/update",method:"post",data:e})}function o(e){return Object(s["a"])({url:"/message/readPage",method:"post",data:e})}function l(e){return Object(s["a"])({url:"/message/updateReadSts",method:"post",data:e})}}}]);